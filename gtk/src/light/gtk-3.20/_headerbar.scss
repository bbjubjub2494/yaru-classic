@import 'ubuntu-colors';

$small_radius: 4px;

@mixin draw_circle($c, $close:false, $size:24px) {
    $button_size: $size + 2px * 2;
    $circle_size: 20px / $button_size / 2;

    background-image: -gtk-gradient(radial,
        center center, 0,
        center center, $circle_size,
        to($c),
        to(transparent));

    &:hover {
        $_bg: if(lightness($c)<35%, lighten($c, 10%), lighten($c, 5%));
        background-image: -gtk-gradient(radial,
            center center, 0,
            center center, $circle_size,
            to($_bg),
            to(transparent));

        &:backdrop {
            $_bg: lighten($backdrop_headerbar_bg_color, 8%);
            background-image: -gtk-gradient(radial,
                center center, 0,
                center center, $circle_size,
                to($_bg),
                to(transparent));
        }
    }

    &:active {
        $_bg: if(lightness($c)<35%, darken($c, 8%), darken($c, 7%));
        background-image: -gtk-gradient(radial,
            center center, 0,
            center center, $circle_size,
            to($_bg),
            to(transparent));
    }

    @if $close==true {
        &:backdrop {
            color: $backdrop_headerbar_fg_color;
        }
    }
}

@if $variant=='light' {

    headerbar,
    .titlebar {
        @include headerbar_fill($headerbar_bg_color);

        &,
        & label.title {
            color: $headerbar_fg_color;
        }

        border-color: darken($inkstone, 11%);

        box-shadow: inset 0 1px $headerbar_border_color;

        &:backdrop {
            border-color: mix(darken($inkstone, 11%), darken($inkstone, 1%), 80%);
            background-color: $backdrop_headerbar_bg_color;
            box-shadow: none;

            transition: $backdrop_transition;
        }

        button,
        button.image-button,
        button.text.button,
        button.toggle,
        box button.toggle,
        buttonbox.toggle {
            @include button(normal, $headerbar_bg_color, $headerbar_fg_color);

            &:hover {
                @include button(hover, $headerbar_bg_color, $headerbar_fg_color);
            }

            &:active,
            &:checked,
            &.toggle:checked,
            &.toggle:active {
                @include button(active, $headerbar_bg_color, $headerbar_fg_color);
            }

            &:backdrop {

                &.flat,
                & {
                    @include button(backdrop, $headerbar_bg_color, $headerbar_fg_color);

                    -gtk-icon-effect: none;
                    border-color: $headerbar_border_color;

                    &:active,
                    &:checked {
                        @include button(backdrop-active, $headerbar_bg_color, $headerbar_fg_color);

                        border-color: $headerbar_border_color;
                    }

                    &:disabled {
                        @include button(backdrop-insensitive, darken($headerbar_bg_color, 15%), $headerbar_fg_color);

                        border-color: $headerbar_border_color;

                        &:active,
                        &:checked {
                            @include button(backdrop-insensitive-active, darken($headerbar_bg_color, 15%), $headerbar_fg_color);

                            border-color: $headerbar_border_color;
                        }
                    }
                }
            }

            &.flat {

                &:backdrop,
                &:disabled,
                &:backdrop:disabled {
                    @include button(undecorated);
                }
            }

            &:disabled {
                @include button(insensitive, darken($headerbar_bg_color, 15%), $headerbar_fg_color);

                &:active,
                &:checked {
                    @include button(insensitive-active, $headerbar_bg_color, $headerbar_fg_color);
                }
            }
        }

        separator {
            background: image(darken(#3d3d3d, 11%));
        }
    }
}

// Window Close button
button.titlebutton {
    $c: $headerbar_bg_color;
    $tc: $headerbar_fg_color;

    &,
    &:hover,
    &:active {

        headerbar &,
        .titlebar &,
        & {

            // spec bump otherwise :backdrop  will still have a bg
            &,
            &:backdrop {
                @extend %undecorated_button;
            }
        }
    }

    border-radius: $small_radius;
    min-height: 24px;
    min-width: 24px;
    padding: 2px;

    &:not(.close):not(.appmenu) {
        &:hover {
            @include draw_circle($c);
        }

        &:active {
            @include draw_circle($c);
        }
    }

    &.close {
        @include draw_circle($selected_bg_color, $close: true);

        &:hover {
            @include draw_circle($selected_bg_color, $close: true);
        }

        &:active {
            @include draw_circle($selected_bg_color, $close: true);
        }
    }
}